#!/usr/bin/env sh

# No battery found.
if [[ -z $(pmset -g batt | grep "InternalBattery") ]]; then
    echo "No battery found."
    exit 1
fi

# Define some variables.
CHARGED=$(pmset -g batt | grep -w "charged")
CHARGING=$(pmset -g batt | grep -w "AC Power")
DISCHARGING=$(pmset -g batt | grep -w "Battery Power")
TIME=$(pmset -g batt | grep InternalBattery | awk '{print $5}' | grep '^[0-9]')
PERCENT=$(pmset -g batt | grep InternalBattery | awk '{print $3}')
PERCENT=${PERCENT%?} # Strips the last character (;)

CHARGING_ICON="\xe2\x9a\xa1"
DISCHARGING_ICON="\xf0\x9f\x94\x8b"

# Hide time when calculating an estimate.
if [[ -z $TIME || $TIME = "0:00" ]] ; then
    TIME="calc..."
fi

# Hide time when battery is charged.
if [[ ! -z $CHARGED ]]; then
    TIME=""
fi

# Only show percentage when battery is charged 100%.
if [[ -z $CHARGED ]]; then
    PERCENT=""
fi

if [[ ! -z $CHARGING ]]; then
    ICON=$CHARGING_ICON
fi

if [[ ! -z $DISCHARGING ]]; then
    ICON=$DISCHARGING_ICON
fi

echo "$ICON  $TIME$PERCENT"
